!function(c){"use strict";var n={hide:function(){c(".ctb-modal").fadeOut()}};if(c(".ctb-modal-open").on("click",function(e){e.preventDefault(),c(".ctb-modal").fadeIn()}),c(".ctb-modal-close").on("click",function(){n.hide()}),c("#create-stripe-plan-form").on("submit",function(e){e.preventDefault();var t=c(this),a=t.serialize();c("#stripe_submit").attr("disabled",!0).addClass("submitted"),c.ajax({method:"POST",url:ajaxurl,data:a+"&action=create_stripe_plan"}).done(function(e){0==e.success?(void 0!==e.error&&t.before('<div class="stripe-plan-message">'+e.error+"</div>"),c("#stripe_submit").attr("disabled",!1).removeClass("submitted")):(void 0!==e.plan_id&&c("#_cth_stripe_plan_id").val(e.plan_id),n.hide(),t.remove())}).fail(function(e,t,a){console.log(e)})}),c(document).on("click",".repeater-fields-wrap .addfield,.repeater-fields-wrap .btn-add",function(e){e.preventDefault();var t=c(this).closest(".repeater-fields-wrap"),a=t.children(".repeater-fields"),n=c(this).closest(".repeater-widgets-wrap"),i=c(this).data("index")?c(this).data("index"):a.children().length?a.children().length:0,r=c(this).data("parent-index")?c(this).data("parent-index"):void 0!==n?n.children(".repeater-widgets").children().length:1,l=void 0!==c(this).data("name")?c(this).data("name"):"add_widget_child_name",o=t.data("tmpl"),s=t.data("tmpl_data")?t.data("tmpl_data"):{},d=_.template(c("#"+o).html(),{variable:"data",evaluate:/<#([\s\S]+?)#>/g,interpolate:/{{{([\s\S]+?)}}}/g,escape:/{{([^}]+?)}}(?!})/g});a.append(d(c.extend({index:++i,parentindex:r,field_name:l},s))),c(this).data("index",i),c(this).data("parent-index",r)}),c(document).on("click",".repeater-fields-wrap .rmfield,.repeater-fields-wrap .btn-del",function(e){e.preventDefault(),c(this).closest(".entry").remove()}),c(document).on("click",".repeater-widgets-wrap .addwidget",function(e){e.preventDefault();var t=c(this).closest(".repeater-widgets-wrap"),a=t.children(".repeater-widgets"),n=c(this).data("index")?c(this).data("index"):a.children().length?a.children().length:0,i=void 0!==c(this).data("name")?c(this).data("name"):"add_widget_name",r=t.data("tmpl"),l=t.data("tmpl_data")?t.data("tmpl_data"):{},o=_.template(c("#"+r).html(),{variable:"data",evaluate:/<#([\s\S]+?)#>/g,interpolate:/{{{([\s\S]+?)}}}/g,escape:/{{([^}]+?)}}(?!})/g});a.append(o(c.extend({index:++n,field_name:i},l))),c(this).data("index",n)}),c(document).on("click",".repeater-widgets-wrap .rmwidget",function(e){e.preventDefault(),c(this).closest(".entry").remove()}),c(document).on("click",".repeater-key-wrap .addkeymobileapp",function(e){e.preventDefault();var t=c(this).closest(".repeater-key-wrap"),a=t.children(".repeater-key-mobile-app"),n=c(this).data("index")?c(this).data("index"):a.children().length?a.children().length:0,i=void 0!==c(this).data("name")?c(this).data("name"):"add_widget_name",r=t.data("tmpl"),l=btoa(Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)),o=t.data("tmpl_data")?t.data("tmpl_data"):{},s=_.template(c("#"+r).html(),{variable:"data",evaluate:/<#([\s\S]+?)#>/g,interpolate:/{{{([\s\S]+?)}}}/g,escape:/{{([^}]+?)}}(?!})/g});a.append(s(c.extend({index:++n,key:l,field_name:i},o))),c(this).data("index",n)}),c(document).on("click",".repeater-key-wrap .rmkey",function(e){e.preventDefault(),c(this).closest(".entry").remove()}),c(document).on("click",".tabs-menu a",function(e){e.preventDefault();var t=c(this),a=t.attr("href");t.parent().addClass("current"),t.parent().siblings().removeClass("current"),t.closest(".tabs-wrapper").find(".tab-content").not(a).removeClass("current"),t.closest(".tabs-wrapper").find(a).addClass("current")}),_townhub_add_ons_admin.free_map){var o={},e=ol.inherits,t=ol.interaction.Pointer,s=ol.interaction.defaults;o.Drag=function(){t.call(this,{handleDownEvent:o.Drag.prototype.handleDownEvent,handleDragEvent:o.Drag.prototype.handleDragEvent,handleMoveEvent:o.Drag.prototype.handleMoveEvent,handleUpEvent:o.Drag.prototype.handleUpEvent}),this.coordinate_=null,this.cursor_="pointer",this.feature_=null,this.previousCursor_=void 0},e(o.Drag,t),o.Drag.prototype.handleDownEvent=function(e){var t=e.map.forEachFeatureAtPixel(e.pixel,function(e){return e});return t&&(this.coordinate_=e.coordinate,this.feature_=t),!!t},o.Drag.prototype.handleDragEvent=function(e){var t,a=e.coordinate[0]-this.coordinate_[0],n=e.coordinate[1]-this.coordinate_[1];this.feature_.getGeometry().translate(a,n),this.coordinate_[0]=e.coordinate[0],this.coordinate_[1]=e.coordinate[1],null!=this.coordinate_&&(t=ol.proj.transform(this.coordinate_,"EPSG:3857","EPSG:4326"),c("#contact_infos_latitude").val(t[1]),c("#contact_infos_longitude").val(t[0]),i(t))},o.Drag.prototype.handleMoveEvent=function(e){if(this.cursor_){var t=e.map.forEachFeatureAtPixel(e.pixel,function(e){return e}),a=e.map.getTargetElement();t?a.style.cursor!=this.cursor_&&(this.previousCursor_=a.style.cursor,a.style.cursor=this.cursor_):void 0!==this.previousCursor_&&(a.style.cursor=this.previousCursor_,this.previousCursor_=void 0)}},o.Drag.prototype.handleUpEvent=function(){return this.coordinate_=null,this.feature_=null,!1},c(".submitMapOSM").length&&c(window).load(function(){c(".submitMapOSM").each(function(){var e=c(this),t=e.attr("id"),a=[parseFloat(_townhub_add_ons_admin.center_lng),parseFloat(_townhub_add_ons_admin.center_lat)];e.data("lat")&&e.data("lng")&&(a=[parseFloat(e.data("lng")),parseFloat(e.data("lat"))]);var n=new ol.View({center:ol.proj.fromLonLat(a),zoom:parseInt(_townhub_add_ons_admin.map_zoom)}),i=new ol.Feature({geometry:new ol.geom.Point(ol.proj.transform(a,"EPSG:4326","EPSG:3857"))}),r=new ol.style.Style({image:new ol.style.Icon({anchor:[.5,.5],anchorXUnits:"fraction",anchorYUnits:"fraction",src:_townhub_add_ons_admin.marker,crossOrigin:"anonymous"})});i.setStyle(r);var l=new ol.layer.Vector({source:new ol.source.Vector({features:[i]})});new ol.Map({interactions:s().extend([new o.Drag]),target:t,view:n,layers:[new ol.layer.Tile({preload:3,source:new ol.source.OSM}),l],loadTilesWhileAnimating:!0})})})}else{c(".submitMap").length&&c(window).load(function(){c(".submitMap").each(function(){var e=c(this),t={lat:parseFloat(_townhub_add_ons_admin.center_lat),lng:parseFloat(_townhub_add_ons_admin.center_lng)};e.data("lat")&&e.data("lng")&&(t={lng:parseFloat(e.data("lng")),lat:parseFloat(e.data("lat"))});var a=new google.maps.Map(e[0],{zoom:10,center:t,styles:[{featureType:"landscape",elementType:"all",stylers:[{color:"#f2f2f2"}]}]}),n=new google.maps.Marker({position:t,map:a,draggable:!0});n.addListener("dragend",function(e){c("#contact_infos_latitude").val(e.latLng.lat()),c("#contact_infos_longitude").val(e.latLng.lng()),i([e.latLng.lng(),e.latLng.lat()])}),c(document).on("webkitfullscreenchange mozfullscreenchange fullscreenchange",function(){document.fullScreen||document.mozFullScreen||document.webkitIsFullScreen||a.setCenter(n.position)}),c(document).on("change","#contact_infos_latitude, #contact_infos_longitude",function(){var e=new google.maps.LatLng(c("#contact_infos_latitude").val(),c("#contact_infos_longitude").val());n.setPosition(e),a.setCenter(e)})})})}function i(e){var t="https://nominatim.openstreetmap.org/reverse?format=json&lat="+e[1]+"&lon="+e[0]+"&zoom=18&addressdetails=1";fetch(t).then(function(e){return e.json()}).then(function(e){null!=e.display_name&&e.display_name&&c("#contact_infos_address").val(e.display_name)})}c(function(){c(".use-select2").length&&c(".use-select2").select2(),c("#listing_expire_date").datetimepicker({formatDate:"Y-m-d",formatTime:"H:i:s",format:"Y-m-d H:i:s",allowBlank:!0}),c("#expiry_date").datetimepicker({formatDate:"Y-m-d",formatTime:"H:i:s",format:"Y-m-d H:i:s",allowBlank:!0})});var a="";c(document).on("click",".cth-addons-tab",function(e){e.preventDefault();var t=c(this);c(".cth-addons-tab").removeClass("nav-tab-active"),t.addClass("nav-tab-active"),c(".cth-addons-pane").removeClass("current"),c(t.attr("href")).addClass("current"),c('#ctb-addons-options-form input[name="_wp_http_referer"]').length&&(""==a&&(a=c('#ctb-addons-options-form input[name="_wp_http_referer"]').val()),a=a.replace(/&addonstab=\w*/gi,""),c('#ctb-addons-options-form input[name="_wp_http_referer"]').val(a+"&addonstab="+t.data("tabid")))}),c(function(){c(document).on("click",".set-lfeatured",function(e){e.preventDefault();var n=c(this),t={action:"admin_lfeatured",lid:c(this).data("id")},a=!1;n.hasClass("lfeatured")&&(a=!0,t.lfeatured=!0),n.addClass("do-process").attr("disabled",!0),c.ajax({method:"POST",url:ajaxurl,data:t}).done(function(e){e.success&&(a?n.removeClass("lfeatured"):n.addClass("lfeatured")),n.removeClass("do-process").attr("disabled",!1)}).fail(function(e,t,a){n.removeClass("do-process").attr("disabled",!1)})}),c("#claim_status").on("change",function(){"asked_charge"==c(this).val()?c("#claim_price_tr").addClass("claim-fee-asked"):c("#claim_price_tr").removeClass("claim-fee-asked")}),c(document).on("click",".set-lverified",function(e){e.preventDefault();var n=c(this),t={action:"admin_lverified",lid:c(this).data("id")},a=!1;n.hasClass("lverified")&&(a=!0,t.lverified=!0),n.addClass("do-process").attr("disabled",!0),c.ajax({method:"POST",url:ajaxurl,data:t}).done(function(e){e.success&&(a?n.removeClass("lverified"):n.addClass("lverified")),n.removeClass("do-process").attr("disabled",!1)}).fail(function(e,t,a){n.removeClass("do-process").attr("disabled",!1)})})})}(jQuery),function(o){"use strict";function e(){o(".scroll-fixed-available").length&&o(".scroll-fixed-available").scrollToFixed({marginTop:32,minWidth:300,limit:function(){var e=o(".scroll-fixed-limit").offset().top-o(".scroll-fixed-available").outerHeight(!0);return e},removeOffsets:!0})}window.addEventListener("fieldsMounted",function(){return e()}),o(function(){var r,l;e(),o(".select-images-list").sortable(),o(".select-images-btn").on("click",function(e){e.preventDefault();var a=o(this),n=null==a.data("single")&&"toggle",i=o(this).data("field");(r=wp.media.frames.file_frame=wp.media({title:a.data("uploader_title"),button:{text:a.data("uploader_button_text")},multiple:n})).on("select",function(){if(n){r.state().get("selection").map(function(e){e=e.toJSON();var t=_.template(o("#tmpl-imageslist").html(),{variable:"data",evaluate:/<#([\s\S]+?)#>/g,interpolate:/{{{([\s\S]+?)}}}/g,escape:/{{([^}]+?)}}(?!})/g});a.closest(".select-images-wrap").children(".select-images-list").append(t(o.extend({},e,{field:i})))})}else{var e=r.state().get("selection").first().toJSON(),t=_.template(o("#tmpl-imageslist").html(),{variable:"data",evaluate:/<#([\s\S]+?)#>/g,interpolate:/{{{([\s\S]+?)}}}/g,escape:/{{([^}]+?)}}(?!})/g});a.closest(".select-images-wrap").children(".select-images-list").html(t(o.extend({},e,{field:i}))),"custom_avatar"!=a.data("field")&&"cover_bg"!=a.data("field")||a.closest(".edit-profile-photo").children(".profile-photo-wrap").html('<img src="'+e.url+'" class="avatar avatar-150 photo">')}a.closest(".select-images-wrap").children(".select-images-list").sortable()}),r.open()}),o(document).on("click",".select-image-item",function(e){e.preventDefault();var n=o(this),a=o(this).data("field");(r=wp.media.frames.file_frame=wp.media({title:n.data("uploader_title"),button:{text:n.data("uploader_button_text")},multiple:!1})).on("select",function(){var e=r.state().get("selection").first().toJSON(),t=_.template(o("#tmpl-imageslist").html(),{variable:"data",evaluate:/<#([\s\S]+?)#>/g,interpolate:/{{{([\s\S]+?)}}}/g,escape:/{{([^}]+?)}}(?!})/g});n.replaceWith(t(o.extend({},e,{field:a})))}),r.on("open",function(){var e=r.state().get("selection"),t=n.children("input").data("id"),a=wp.media.attachment(t);a.fetch(),e.add(a?[a]:[])}),r.open()}),o(document).on("click",".remove-img-btn",function(e){e.preventDefault(),e.stopPropagation(),o(this).closest(".select-image-item").remove()}),o(".cth-color-field").each(function(){o(this).wpColorPicker()}),o(document).on("click",".get-curr-rate",function(e){e.preventDefault();var t=o(this);t.addClass("loading"),o.ajax({method:"POST",url:ajaxurl,data:{base:t.attr("data-base"),curr:t.attr("data-cur"),action:"get_curr_rate"}}).done(function(e){null!=e.debug&&!0===e.debug&&console.log(e),1==e.success&&null!=e.rate&&(t.closest(".entry").find(".curr-rate-input").val(e.rate),t.removeClass("loading"))})}),o(document).on("change",".currency-cur",function(e){var t=o(this).val();o(this).closest(".entry").find(".get-curr-rate").attr("data-cur",t)}),o(document).on("change",".base_currency_select",function(e){var t=o(this).val();""!=t&&o(".get-curr-rate").attr("data-base",t)}),o(document).on("click",".upload_image_button",function(e){e.preventDefault();var t=o(this),a=o(this).closest(".media-field-wrap"),n=t.attr("class").match(/metakey-\S*/g)[0].substring(8),i=t.attr("class").match(/fieldkey-\S+/g)[0].substring(9),r=n;""!=i&&(r+="["+i+"]"),""==n&&(r=i),r=r.replace(/\[/g,"_").replace(/\]/g,"_"),(l=wp.media.frames.media_frame=wp.media({title:t.data("uploader_title"),button:{text:t.data("uploader_button_text")},multiple:!1})).on("select",function(){var e=l.state().get("selection").first().toJSON();a.find("."+r+"_id").length&&a.find("."+r+"_id").val(e.id),a.find("."+r+"_url").length&&a.find("."+r+"_url").val(e.url),a.find("."+r+"_preview").length&&a.find("."+r+"_preview").attr("src",e.url).css("display","block"),t.next(".remove_image_button").show()}),l.open()}),o(document).on("click",".remove_image_button",function(e){e.preventDefault();var t=o(this),a=o(this).closest(".media-field-wrap"),n=t.attr("class").match(/metakey-\S*/g)[0].substring(8),i=t.attr("class").match(/fieldkey-\S+/g)[0].substring(9),r=n;""!=i&&(r+="["+i+"]"),""==n&&(r=i),r=r.replace(/\[/g,"_").replace(/\]/g,"_"),a.find("."+r+"_id").length&&a.find("."+r+"_id").val(""),a.find("."+r+"_url").length&&a.find("."+r+"_url").val(""),a.find("."+r+"_preview").length&&a.find("."+r+"_preview").attr("src","").css("display","none"),t.hide()})})}(jQuery);