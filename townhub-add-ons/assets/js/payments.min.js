!function(o){"use strict";var s,c,n,r,l,u,p;o(document).on("click",".next-form",function(e){if(e.preventDefault(),!p){p=!0;var t=o(this),n=(o("#townhub-checkout-form")[0],!1),a=null;if(s=t.closest(".ck-fieldset-item"),(c=s.next(".ck-fieldset-item")).length){o(".ck-input-error").remove(),o(".inp-error").removeClass("inp-error");var i=s.find("input");i.length&&i.each(function(){var e=o(this);if("hidden"===e.prop("type")||!0===e.prop("disabled"))return!0;if(!0===e.prop("required")){if(""==e.val()&&("text"===e.prop("type")||"number"===e.prop("type")||"email"===e.prop("type")))return a=this,!(n=!0);if(!1===e.prop("checked")&&("checkbox"===e.prop("type")||"radio"===e.prop("type")))return a=this,!(n=!0)}}),n?(o(a).after('<span class="ck-input-error">'+a.validationMessage+"</span>"),o(a).addClass("inp-error"),p=!1):(o(".ck-input-error").remove(),o(".inp-error").removeClass("inp-error"),o(".ck-tab-item").removeClass("active"),o(".ck-tab-item").eq(o(".ck-fieldset-item").index(c)).addClass("active"),c.show(),s.animate({opacity:0},{step:function(e,t){u=1-.2*(1-e),r=50*e+"%",l=1-e,s.css({transform:"scale("+u+")",position:"absolute"}),c.css({left:r,opacity:l,position:"relative"})},duration:1200,complete:function(){s.hide(),p=!1},easing:"easeInOutBack"}))}}}),o(document).on("click",".back-form",function(e){if(e.preventDefault(),p)return!1;p=!0;var t=o(this);s=t.closest(".ck-fieldset-item"),n=t.closest(".ck-fieldset-item").prev(".ck-fieldset-item"),o(".ck-tab-item").removeClass("active"),o(".ck-tab-item").eq(o(".ck-fieldset-item").index(n)).addClass("active"),n.show(),s.animate({opacity:0},{step:function(e,t){u=.8+.2*(1-e),r=50*(1-e)+"%",l=1-e,s.css({left:r,position:"absolute"}),n.css({transform:"scale("+u+")",opacity:l,position:"relative"})},duration:1200,complete:function(){s.hide(),p=!1},easing:"easeInOutBack"})}),o(document).on("submit","#townhub-checkout-form",function(e){e.preventDefault();var t=new FormData(this),n=o(this),a=o(this).find(".lcheckout_btn");a.addClass("loading"),t.append("action","checkout_form"),o.ajax({type:"POST",url:_townhub_add_ons.url,dataType:"json",data:t,cache:!1,contentType:!1,processData:!1,success:function(e){null!=e.debug&&1==e.debug&&console.log(e),e.success&&(a.removeClass("loading"),null!=e.url&&""!=e.url?window.location.href=e.url:o("#ck-tab-ck_confirm").length&&o("#ck-fieldset-ck_confirm").length?(o(".ck-tab-item").removeClass("active"),o("#ck-tab-ck_confirm").addClass("active"),o(".ck-fieldset-item").hide(),o("#ck-fieldset-ck_confirm").show().addClass("ck-fieldset-show")):null!=e.result&&""!=e.result&&(o("#ck-tab-ck_confirm").length&&(o(".ck-tab-item").removeClass("active"),o("#ck-tab-ck_confirm").addClass("active")),n.before(e.result),n.remove()))},error:function(e){console.log(e)}})}),o(document).on("change",'input[type="radio"][name="payment-method"]',function(e){e.preventDefault();var t=o(this).data("btn")||"",n=o(this).val(),a=o("#lcheckout_btn");t&&a.children(".btn-text").text(t),"stripe"===n?a.addClass("stripe-checkout"):a.removeClass("stripe-checkout")});var a=StripeCheckout.configure({key:_townhub_add_ons_payments.publishable_key,image:_townhub_add_ons_payments.logo,locale:"auto",currency:_townhub_add_ons_payments.currency_code,token:function(e){var t=o("#townhub-checkout-form");t.append('<input type="hidden" name="stripeToken" value="'+e.id+'">'),t.append('<input type="hidden" name="stripeEmail" value="'+e.email+'">'),t.submit()}});o(document).on("click","#lcheckout_btn",function(e){if(o(this).hasClass("stripe-checkout")){var t=o(this).data("payment");null!=t&&(t=o.extend({},{amount:5390,plan:"Basic",email:"",is_recurring:!1},JSON.parse(decodeURIComponent(t)))),a.open({name:_townhub_add_ons_payments.site_title,description:t.is_recurring?_townhub_add_ons_payments.recurring_text.replace("{{plan}}",t.plan):_townhub_add_ons_payments.one_time_text.replace("{{plan}}",t.plan),amount:t.amount,email:_townhub_add_ons_payments.use_email?t.email:""}),e.preventDefault()}}),window.addEventListener("popstate",function(){a.close()})}(jQuery);